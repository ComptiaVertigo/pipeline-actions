name: 'Automerge'
description: 'Common automerge'
inputs:
  METHOD:
    default: "squash"
runs:
  using: "composite"
  steps:
    - uses: actions/github-script@v6
      env: 
        METHOD: ${{ inputs.METHOD }}
      with:
        result-encoding: string
        script: |          
            const METHOD = process.env.METHOD;
            try{
                await github.rest.pulls.merge({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    commit_title: context.payload.pull_request.title,
                    pull_number: context.issue.number,
                    commit_message: "",
                    merge_method: METHOD
                });
                console.log(`Merge done`);

                await github.rest.pulls.update({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    pull_number: context.issue.number,
                    state: "closed"
                });
                console.log(`Pull request updated`);
              
                await github.rest.git.deleteRef({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    ref: `heads/${context.payload.pull_request.head.ref}`,
                });
                console.log(`Branch deleted`);
            }catch(err){
                core.setFailed(`Error automerge: ${err}`);  
            }
            